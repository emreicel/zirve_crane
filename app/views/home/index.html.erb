<div class="dashboard-logo">
  <%= image_tag 'logo.png', alt: 'Company Logo', class: 'logo' %>
</div>

<% if user_signed_in? %>
<h1 class="mb-4">Genel Bakış - <%= Time.current.strftime("%d.%m.%Y") %></h1>

<div class="container-fluid">
  <div class="row">
    <!-- Vinç Durumları Kartı -->
    <div class="col-md-6 mb-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-primary text-white">
          <h5 class="card-title mb-0">Vinç Durumları</h5>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-4">
              <h3 class="text-success"><%= Crane.where(available: true).count %></h3>
              <small class="text-muted">Uygun Vinç</small>
            </div>
            <div class="col-4">
              <h3 class="text-danger"><%= Crane.where(available: false).count %></h3>
              <small class="text-muted">Uygun Olmayan</small>
            </div>
            <div class="col-4">
              <h3 class="text-primary"><%= Crane.count %></h3>
              <small class="text-muted">Toplam</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Kontrat Bilgileri Kartı -->
    <div class="col-md-6 mb-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-primary text-white">
          <h5 class="card-title mb-0">Kontrat Bilgileri</h5>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-6">
              <h3><%= Contract.count %></h3>
              <small class="text-muted">Toplam Kontrat</small>
            </div>
            <div class="col-6">
              <h3><%= number_to_currency(Contract.sum(:rent_amount)) %></h3>
              <small class="text-muted">Toplam Tutar</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card mt-4">
    <div class="card-header">
      <h4>Faturası Kesilecek Ödemeler</h4>
    </div>
    <div class="card-body">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Kira Tarihi</th>
            <th>Müşteri</th>
            <th>Vinç Markası</th>
            <th>Şasi No</th>
            <th>Tutar</th>
            <th>İşlemler</th>
          </tr>
        </thead>
        <tbody>
          <% @missing_documents.each do |payment| %>
            <tr>
              <td><%= payment.start_date&.strftime("%d.%m.%Y") %>
                <% if payment.start_date && payment.start_date < Date.current %>
                  <span class="badge bg-danger ms-2">GECİKTİ</span>
                <% elsif payment.start_date && payment.start_date > Date.current %>
                  <span class="badge bg-success ms-2">YAKLAŞIYOR</span>
                <% end %>
              </td>
              <td><%= payment.contract.customer.customer_name rescue "-" %></td>
              <td><%= payment.contract.crane.crane_brand_name rescue "-" %></td>
              <td><%= payment.contract.crane.crane_chassis_no rescue "-" %></td>
              <td><%= number_to_currency(payment.amount_excluding_vat) %></td>
              <td>
                <%= link_to "Detay", contract_path(payment.contract), class: "btn btn-sm btn-primary" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

</div>

<% else %>
  <%= link_to 'Sign up', new_user_registration_path %> |
  <%= link_to 'Log in', new_user_session_path %>

  
<% end %>
